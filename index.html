<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <link rel="icon" href="assets/favicon.png" type="image/png">

        
        <link rel="stylesheet" href="css/cyrillic-400.min.css">
        <link rel="stylesheet" href="css/cyrillic-500.min.css">
        <link rel="stylesheet" href="css/cyrillic-700.min.css">

        <!-- Styles -->
        <link rel="stylesheet" href="css/inter.css">
        <link rel="stylesheet" href="css/all.min.css">
        <link rel="stylesheet" href="css/tailwind.min.css">

        <!-- JS -->
        <script defer src="js/axios.min.js"></script>
        <script defer src="js/Sortable.min.js"></script>

        <!-- 7. Alpine.js -->
        <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
      
        
        <link rel="preload" as="style" href="css/app-C6G_3qQV.css">
        <link rel="stylesheet" href="css/app-C6G_3qQV.css">
        <link rel="modulepreload" href="js/app-D6_fL4dy.js">
        <script type="module" src="js/app-D6_fL4dy.js"></script>
        <title>
            N1M
            |
                            Home                    </title>

        <style>
            [x-cloak] {
                display: none !important;
            }
        </style>
    </head>
    <body>
        <div x-data class="min-h-screen h-full bg-gray-900 p-4 text-white" x-init="console.log('Im initing')" x-cloak>
            <div
                class="z-50 sticky top-0 left-0 w-screen max-w-screen"
                style="margin-top: -1rem; margin-left: -1rem"
            >
                <div
    x-show="$store.status.value"
    x-bind:class="{
        'py-1 text-lg font-medium bg-gray-600 w-full text-center': true,
        'bg-purple-500': $store.status.value.toLowerCase().includes('queue') && !($store.status.value.toLowerCase().includes('err') || $store.status.value.toLowerCase().includes('cannot be empty')),
        'bg-green-500': $store.status.value.toLowerCase().includes('success'),
        'bg-red-500': $store.status.value.toLowerCase().includes('err') || $store.status.value.toLowerCase().includes('cannot be empty'),
    }"
    x-text="$store.status.value"
></div>
                    <div class="bg-gray-700 w-full p-1 flex flex-wrap gap-1.5 items-center">
    <span class="font-bold mr-2 text-sm">Sections:</span>

    <template x-for="section in $store.ui.sections" :key="section.id">
        <button class="px-2 py-1 rounded text-white text-center border-transparent flex items-center justify-center gap-2 bg-blue-700 hover:bg-blue-600 !px-2 !py-0.5 !text-xs" @click="$store.ui.toggle(section.id)" x-bind:class="{ 'opacity-50': !section.visible }" x-text="section.name">
        
</button>
    </template>

    <div class="ml-auto flex gap-1.5">
        
        <label class="inline-flex items-center space-x-2">
    <input
        type="checkbox"
        x-bind:checked="$el.__x_model ? $el.__x_model.get() : false"
        x-on:change="$el.__x_model && $el.__x_model.set($el.checked)"
        class="rounded border-gray-700 text-blue-600 bg-gray-800 focus:ring-2 focus:ring-blue-500 !text-xs !py-0.5" x-model="$store.ui.includeDurationsInHistory" @change="$store.ui.saveVisibility()"
    >

            <span class="text-white">Durations</span>
    </label>


        <button class="px-2 py-1 rounded text-white text-center border-transparent flex items-center justify-center gap-2 bg-gray-700 hover:bg-gray-600 !px-2 !py-0.5 !text-xs" @click="$store.ui.showAll()">
        Show All
</button>
        <button class="px-2 py-1 rounded text-white text-center border-transparent flex items-center justify-center gap-2 bg-gray-700 hover:bg-gray-600 !px-2 !py-0.5 !text-xs" @click="$store.ui.hideAll()">
        Hide All
</button>

        <button
            @click="$store.ui.toggleMoveMode()"
            class="px-2 py-1 rounded transition-colors"
            x-bind:class="$store.ui.isMoveModeEnabled ? 'bg-green-600 hover:bg-green-500' : 'bg-gray-600 hover:bg-gray-500'"
            title="Toggle Move Mode"
        >
            <i class="fa-solid fa-arrows-up-down-left-right text-xs text-white"></i>
        </button>

        <button
            @click="$store.ui.toggleActionsMenu()"
            class="px-2 py-1 rounded transition-colors"
            x-bind:class="$store.ui.isCompactActionsMenu ? 'bg-gray-600 hover:bg-gray-500' : 'bg-blue-600 hover:bg-blue-500'"
            title="Toggle Actions Menu Style"
        >
            <i class="fa-solid fa-table-cells text-xs text-white"></i>
        </button>
    </div>
</div>

    <div class="bg-gray-400 w-full p-2">
        <div>
    <div x-show="$store.ui.isCompactActionsMenu">
        <div class="flex flex-wrap items-center gap-1.5 p-1 bg-gray-800/70 rounded-lg">
            <div class="flex items-center gap-2">
                <button class="px-2 py-1 rounded text-white text-center border-transparent flex items-center justify-center gap-2 bg-yellow-700 hover:bg-yellow-600 !text-xs" @dblclick="$store.queues.startGeoQueue" title="Start Geo Queue (double-click)">
            <i class="fa-solid fa-globe"></i>
        Queue
</button>
                <label class="inline-flex items-center space-x-2">
    <input
        type="checkbox"
        x-bind:checked="$el.__x_model ? $el.__x_model.get() : false"
        x-on:change="$el.__x_model && $el.__x_model.set($el.checked)"
        class="rounded border-gray-700 text-blue-600 bg-gray-800 focus:ring-2 focus:ring-blue-500" x-model="$store.queues.stop"
    >

            <span class="text-white">Stop</span>
    </label>

                <label class="inline-flex items-center space-x-2">
    <input
        type="checkbox"
        x-bind:checked="$el.__x_model ? $el.__x_model.get() : false"
        x-on:change="$el.__x_model && $el.__x_model.set($el.checked)"
        class="rounded border-gray-700 text-blue-600 bg-gray-800 focus:ring-2 focus:ring-blue-500" x-model="$store.queues.continue"
    >

            <span class="text-white">Continue</span>
    </label>

            </div>
            <div class="h-6 w-px bg-gray-700"></div>
            <button class="px-2 py-1 rounded text-white text-center border-transparent flex items-center justify-center gap-2 bg-red-500 hover:bg-red-400 !px-2.5 !py-1.5" @dblclick="$store.storyGeneration.clear" title="Double-click to clear story data">
        <i class="fa-solid fa-eraser"></i>
</button>
            <div class="h-6 w-px bg-gray-700"></div>
            <div class="flex items-center gap-1.5">
                <button class="px-2 py-1 rounded text-white text-center border-transparent flex items-center justify-center gap-2 bg-yellow-700 hover:bg-yellow-600 !text-xs !font-bold" @dblclick="$store.storyGeneration.startAllStoryProcesses" title="Run all story generation steps (double-click)">
        STORY
</button>
                <button class="px-2 py-1 rounded text-white text-center border-transparent flex items-center justify-center gap-2 bg-gray-700 hover:bg-gray-600" @click="$store.storyGeneration.generateTopic" title="Generate Topic">
        <i class="fa-solid fa-t"></i>
</button>
                <button class="px-2 py-1 rounded text-white text-center border-transparent flex items-center justify-center gap-2 bg-gray-700 hover:bg-gray-600" @click="$store.storyGeneration.generateStory" title="Generate Scenery">
        <i class="fa-solid fa-list-ol"></i>
</button>
                <button class="px-2 py-1 rounded text-white text-center border-transparent flex items-center justify-center gap-2 bg-gray-700 hover:bg-gray-600" x-show="$store.storyGeneration.scenes.length > 0" @click="$store.storyGeneration.generateAllScenesImagesPrompts" title="Generate Image Prompts">
        <i class="fa-solid fa-quote-right"></i>
</button>
                <button class="px-2 py-1 rounded text-white text-center border-transparent flex items-center justify-center gap-2 bg-gray-700 hover:bg-gray-600" x-show="$store.storyGeneration.scenes.length > 0" @click="$store.storyGeneration.generateAllScenesImages" title="Generate Images">
        <i class="fa-solid fa-images"></i>
</button>
                <button class="px-2 py-1 rounded text-white text-center border-transparent flex items-center justify-center gap-2 bg-gray-700 hover:bg-gray-600" x-show="$store.storyGeneration.scenes.length > 0" @click="$store.audioScenes.generateAllVoiceovers" title="Generate Voiceovers">
        <i class="fa-solid fa-microphone-lines"></i>
</button>
            </div>
            <div x-show="$store.audioScenes.list.length > 0" class="flex items-center gap-1.5">
                <div class="h-6 w-px bg-gray-700"></div>
                <button class="px-2 py-1 rounded text-white text-center border-transparent flex items-center justify-center gap-2 bg-yellow-700 hover:bg-yellow-600 !text-xs !font-bold" @dblclick="$store.storyGeneration.startAllVideoEditingProcesses" title="Run all video editing steps (double-click)" x-bind:disabled="$store.storyGeneration.disableVideoEditingButtons" x-bind:class="$store.storyGeneration.disableVideoEditingButtons ? 'cursor-not-allowed opacity-70' : ''">
        VIDEO
</button>
                <button class="px-2 py-1 rounded text-white text-center border-transparent flex items-center justify-center gap-2 bg-gray-700 hover:bg-gray-600" x-show="$store.storyGeneration.scenes.length > 0" @click="$store.storyGeneration.mergeStory" title="Merge images and audio" x-bind:disabled="$store.storyGeneration.disableVideoEditingButtons" x-bind:class="$store.storyGeneration.disableVideoEditingButtons ? 'cursor-not-allowed opacity-70' : ''">
        <i class="fa-solid fa-layer-group"></i>
</button>
                <button class="px-2 py-1 rounded text-white text-center border-transparent flex items-center justify-center gap-2 bg-gray-700 hover:bg-gray-600" x-show="$store.storyGeneration.backgroundMusicId && ($store.storyGeneration.videoWithSubtitlesPath || $store.storyGeneration.middleVideoPath)" @click="$store.storyGeneration.addBackgroundMusic" title="Add Background Music">
        <i class="fa-solid fa-music"></i>
</button>
            </div>
            <div class="flex-grow"></div>
            <div class="flex items-center gap-1.5">
                <button class="px-2 py-1 rounded text-white text-center border-transparent flex items-center justify-center gap-2 bg-green-500 hover:bg-green-400 !text-xs" x-show="$store.storyGeneration.transcription || $store.storyGeneration.scenes.length > 0" @click="$store.stories.save" title="Save as a new story entry">
            <i class="fa-solid fa-save"></i>
        NEW
</button>
                <button class="px-2 py-1 rounded text-white text-center border-transparent flex items-center justify-center gap-2 bg-yellow-900 hover:bg-yellow-800 !text-xs" x-show="$store.storyGeneration.transcription || $store.storyGeneration.scenes.length > 0" @click="$store.stories.save(true)" title="Update the current story entry">
            <i class="fa-solid fa-floppy-disk"></i>
        UPDATE
</button>
                <a x-show="$store.storyGeneration.previewImagePath" x-bind:href="`/stories/${$store.storyGeneration.id}/download/preview-image`" download target="_blank" class="px-2 py-1 rounded text-white text-center flex items-center justify-center gap-2 bg-purple-700 hover:bg-purple-600" title="Download Preview Image"><i class="fa-regular fa-image"></i></a>
                <a x-show="$store.storyGeneration.middleVideoPath" x-bind:href="`/stories/${$store.storyGeneration.id}/download/middle-video`" download target="_blank" class="px-2 py-1 rounded text-white text-center flex items-center justify-center gap-2 bg-purple-700 hover:bg-purple-600" title="Download Middle Video"><i class="fa-solid fa-circle-play"></i></a>
                <a x-show="$store.storyGeneration.videoWithMusicPath" x-bind:href="`/stories/${$store.storyGeneration.id}/download/video-with-music`" download target="_blank" class="px-2 py-1 rounded text-white text-center flex items-center justify-center gap-2 bg-purple-700 hover:bg-purple-600" title="Download Final Video with Music"><i class="fa-solid fa-video"></i></a>
            </div>
        </div>
    </div>

    <div x-show="!$store.ui.isCompactActionsMenu">
        <div class="flex flex-wrap items-start gap-3 p-2">
            <div class="flex items-center gap-3 p-2 rounded-lg bg-gray-800/50">
                <div class="flex items-center gap-2">
                    <button class="px-2 py-1 rounded text-white text-center border-transparent flex items-center justify-center gap-2 bg-yellow-700 hover:bg-yellow-600" @dblclick="$store.storyGeneration.startAllStoryProcesses" title="Run all story generation steps (double-click)">
        <i class="fa-solid fa-wand-magic-sparkles"></i> STORY
</button>
                    <div class="h-6 w-px bg-gray-600"></div>
                    <button class="px-2 py-1 rounded text-white text-center border-transparent flex items-center justify-center gap-2 bg-gray-700 hover:bg-gray-600" @click="$store.storyGeneration.generateTopic" title="Generate Topic">
        Topic
</button>
                    <button class="px-2 py-1 rounded text-white text-center border-transparent flex items-center justify-center gap-2 bg-gray-700 hover:bg-gray-600" @click="$store.storyGeneration.generateStory" title="Generate Scenery">
        Scenery
</button>
                    <button class="px-2 py-1 rounded text-white text-center border-transparent flex items-center justify-center gap-2 bg-gray-700 hover:bg-gray-600" x-show="$store.storyGeneration.scenes.length > 0" @click="$store.storyGeneration.generateAllScenesImagesPrompts" title="Generate Image Prompts">
        Img Prompts
</button>
                    <button class="px-2 py-1 rounded text-white text-center border-transparent flex items-center justify-center gap-2 bg-gray-700 hover:bg-gray-600" x-show="$store.storyGeneration.scenes.length > 0" @click="$store.storyGeneration.generateAllScenesImages" title="Generate Images">
        Images
</button>
                    <button class="px-2 py-1 rounded text-white text-center border-transparent flex items-center justify-center gap-2 bg-gray-700 hover:bg-gray-600" x-show="$store.storyGeneration.scenes.length > 0" @click="$store.audioScenes.generateAllVoiceovers" title="Generate Voiceovers">
        Voiceovers
</button>
                </div>
                <div x-show="$store.audioScenes.list.length > 0" class="flex items-center gap-2">
                    <div class="h-6 w-px bg-gray-700"></div>
                    <button class="px-2 py-1 rounded text-white text-center border-transparent flex items-center justify-center gap-2 bg-yellow-700 hover:bg-yellow-600" @dblclick="$store.storyGeneration.startAllVideoEditingProcesses" title="Run all video editing steps (double-click)" x-bind:disabled="$store.storyGeneration.disableVideoEditingButtons" x-bind:class="$store.storyGeneration.disableVideoEditingButtons ? 'cursor-not-allowed opacity-70' : ''">
        <i class="fa-solid fa-film"></i> VIDEO
</button>
                    <div class="h-6 w-px bg-gray-600"></div>
                    <button class="px-2 py-1 rounded text-white text-center border-transparent flex items-center justify-center gap-2 bg-gray-700 hover:bg-gray-600" x-show="$store.storyGeneration.scenes.length > 0" @click="$store.storyGeneration.mergeStory" title="Merge images and audio" x-bind:disabled="$store.storyGeneration.disableVideoEditingButtons" x-bind:class="$store.storyGeneration.disableVideoEditingButtons ? 'cursor-not-allowed opacity-70' : ''">
        Merge
</button>
                    <button class="px-2 py-1 rounded text-white text-center border-transparent flex items-center justify-center gap-2 bg-gray-700 hover:bg-gray-600" x-show="$store.storyGeneration.backgroundMusicId && ($store.storyGeneration.videoWithSubtitlesPath || $store.storyGeneration.middleVideoPath)" @click="$store.storyGeneration.addBackgroundMusic" title="Add Background Music">
        BG Music
</button>
                </div>
            </div>
            <div class="flex items-center gap-3 p-2 rounded-lg bg-gray-800/50">
                <div x-show="$store.storyGeneration.transcription || $store.storyGeneration.scenes.length > 0" class="flex items-center gap-2">
                    <button class="px-2 py-1 rounded text-white text-center border-transparent flex items-center justify-center gap-2 bg-green-500 hover:bg-green-400" @click="$store.stories.save" title="Save as a new story entry">
            <i class="fa-solid fa-save"></i>
        SAVE NEW
</button>
                    <button class="px-2 py-1 rounded text-white text-center border-transparent flex items-center justify-center gap-2 bg-yellow-900 hover:bg-yellow-800" @click="$store.stories.save(true)" title="Update the current story entry">
            <i class="fa-solid fa-floppy-disk"></i>
        UPDATE
</button>
                </div>
                <div x-data="{ open: false }" class="relative" x-show="$store.storyGeneration.middleVideoPath || $store.storyGeneration.previewImagePath">
                    <button class="px-2 py-1 rounded text-white text-center border-transparent flex items-center justify-center gap-2 bg-gray-700 hover:bg-gray-600" @click="open = !open">
            <i class="fa-solid fa-download"></i>
        Downloads<i class="fa-solid fa-chevron-down text-xs transition-transform" :class="{ 'rotate-180': open }"></i>
</button>
                    <div x-show="open" @click.away="open = false" x-cloak class="absolute right-0 mt-2 w-48 bg-gray-700 rounded-md shadow-lg z-20 py-1">
                        <a x-show="$store.storyGeneration.previewImagePath" x-bind:href="`/stories/${$store.storyGeneration.id}/download/preview-image`" download target="_blank" class="block px-4 py-2 text-sm text-white hover:bg-gray-600">Preview Image</a>
                        <a x-show="$store.storyGeneration.middleVideoPath" x-bind:href="`/stories/${$store.storyGeneration.id}/download/middle-video`" download target="_blank" class="block px-4 py-2 text-sm text-white hover:bg-gray-600">Middle Video</a>
                        <a x-show="$store.storyGeneration.videoWithMusicPath" x-bind:href="`/stories/${$store.storyGeneration.id}/download/video-with-music`" download target="_blank" class="block px-4 py-2 text-sm text-white hover:bg-gray-600">With Music</a>
                    </div>
                </div>
            </div>
            <div class="flex items-center gap-3 p-2 rounded-lg bg-gray-800/50">
                <button class="px-2 py-1 rounded text-white text-center border-transparent flex items-center justify-center gap-2 bg-yellow-700 hover:bg-yellow-600" @dblclick="$store.queues.startGeoQueue" title="Start Geo Queue (double-click)">
            <i class="fa-solid fa-globe"></i>
        Start Geo Queue
</button>
                <label class="inline-flex items-center space-x-2">
    <input
        type="checkbox"
        x-bind:checked="$el.__x_model ? $el.__x_model.get() : false"
        x-on:change="$el.__x_model && $el.__x_model.set($el.checked)"
        class="rounded border-gray-700 text-blue-600 bg-gray-800 focus:ring-2 focus:ring-blue-500" x-model="$store.queues.stop"
    >

            <span class="text-white">Stop</span>
    </label>

                <label class="inline-flex items-center space-x-2">
    <input
        type="checkbox"
        x-bind:checked="$el.__x_model ? $el.__x_model.get() : false"
        x-on:change="$el.__x_model && $el.__x_model.set($el.checked)"
        class="rounded border-gray-700 text-blue-600 bg-gray-800 focus:ring-2 focus:ring-blue-500" x-model="$store.queues.continue"
    >

            <span class="text-white">Continue</span>
    </label>

            </div>
            <div class="flex items-center">
                <button class="px-2 py-1 rounded text-white text-center border-transparent flex items-center justify-center gap-2 bg-red-500 hover:bg-red-400" @dblclick="$store.storyGeneration.clear" title="Double-click to clear current story data">
            <i class="fa-solid fa-eraser"></i>
        
</button>
            </div>
        </div>
    </div>
</div>
    </div>
            </div>

                <div
        x-data="{
            sortableInstance: null,
            initPage() {
                const container = this.$el;
                const orderedIds = Alpine.store('ui').sections.map(s => s.id);
                const children = Array.from(container.children);
                const sortedChildren = orderedIds.map(id =>
                    children.find(c => c.dataset.sectionId === id)
                ).filter(Boolean);

                sortedChildren.forEach(child => container.appendChild(child));

                this.sortableInstance = new Sortable(container, {
                    handle: '.drag-handle',
                    animation: 150,
                    disabled: !Alpine.store('ui').isMoveModeEnabled,
                    onEnd: (evt) => {
                        const newOrderIds = Array.from(evt.to.children).map(child => child.dataset.sectionId);
                        Alpine.store('ui').sections.sort((a, b) => newOrderIds.indexOf(a.id) - newOrderIds.indexOf(b.id));
                        Alpine.store('ui').saveOrder();
                    },
                });

                $watch('$store.ui.isMoveModeEnabled', (enabled) => {
                    this.sortableInstance.option('disabled', !enabled);
                });
            }
        }"
        x-init="initPage()"
        class="flex flex-col gap-4"
    >
        <div
            data-section-id="automationPrompts"
            x-show="$store.ui.sections.find(s => s.id === 'automationPrompts').visible"
            class="relative border rounded-lg p-1"
            x-bind:class="$store.ui.isMoveModeEnabled ? 'border-gray-600 group' : 'border-transparent'"
        >
            <div class="drag-handle absolute top-2 right-2 p-2 bg-gray-700 rounded-full cursor-grab opacity-0 group-hover:opacity-100 transition-opacity z-50">
                <i class="fa-solid fa-grip-vertical text-white"></i>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-3" x-data="{ automationPromptsVisible: false, imagePromptsVisible: false }">

    <div class="bg-gray-800/50 p-3 rounded-lg">
        <h3 class="font-bold text-lg mb-2 border-b border-gray-700 pb-2">Primary Inputs</h3>
        <div class="space-y-3 pt-2">
            <div>
                <label for="ids-queue" class="block mb-1 text-sm font-medium">Queue of queues IDs</label>
                <input
    x-bind:value="$el.__x_model ? $el.__x_model.get() : ''"
    x-on:input="$el.__x_model && $el.__x_model.set($el.value)"
    class="w-full p-2 border rounded bg-gray-800 border-gray-700 text-white" id="ids-queue" x-model="$store.queues.idsQueue" placeholder="e.g., 1,5,17..."
>
            </div>
            <div>
                <label for="story-topic-ref" class="block mb-1 text-sm font-medium">Topic reference</label>
                <input
    x-bind:value="$el.__x_model ? $el.__x_model.get() : ''"
    x-on:input="$el.__x_model && $el.__x_model.set($el.value)"
    class="w-full p-2 border rounded bg-gray-800 border-gray-700 text-white" id="story-topic-ref" x-model="$store.storyGeneration.topicReference" placeholder="Enter topic reference"
>
            </div>
            <div>
                <label for="transcription" class="block mb-1 text-sm font-medium">Transcription</label>
                <textarea
    x-bind:value="$el.__x_model ? $el.__x_model.get() : ''"
    x-on:input="$el.__x_model && $el.__x_model.set($el.value)"
    class="w-full p-2 border rounded bg-gray-800 border-gray-700 text-white h-40" id="transcription" x-model="$store.storyGeneration.transcription" placeholder="Enter transcription"
></textarea>
            </div>
        </div>
    </div>

    <div class="bg-gray-800/50 p-3 rounded-lg">
        <h3 class="font-bold text-lg mb-2 border-b border-gray-700 pb-2">Additional Settings</h3>
        <div class="space-y-3 pt-2">
            <div>
                <label for="story-topic" class="block mb-1 text-sm font-medium">Story Topic</label>
                <input
    x-bind:value="$el.__x_model ? $el.__x_model.get() : ''"
    x-on:input="$el.__x_model && $el.__x_model.set($el.value)"
    class="w-full p-2 border rounded bg-gray-800 border-gray-700 text-white" id="story-topic" x-model="$store.storyGeneration.topic" placeholder="Enter story topic"
>
            </div>
            <div class="flex items-center space-x-4">
                <label class="inline-flex items-center space-x-2">
    <input
        type="checkbox"
        x-bind:checked="$el.__x_model ? $el.__x_model.get() : false"
        x-on:change="$el.__x_model && $el.__x_model.set($el.checked)"
        class="rounded border-gray-700 text-blue-600 bg-gray-800 focus:ring-2 focus:ring-blue-500" x-model="$store.storyGeneration.finished"
    >

            <span class="text-white">Finished</span>
    </label>

                <label class="inline-flex items-center space-x-2">
    <input
        type="checkbox"
        x-bind:checked="$el.__x_model ? $el.__x_model.get() : false"
        x-on:change="$el.__x_model && $el.__x_model.set($el.checked)"
        class="rounded border-gray-700 text-blue-600 bg-gray-800 focus:ring-2 focus:ring-blue-500" x-model="$store.storyGeneration.replacement"
    >

            <span class="text-white">Geo replace</span>
    </label>

                <label class="inline-flex items-center space-x-2">
    <input
        type="checkbox"
        x-bind:checked="$el.__x_model ? $el.__x_model.get() : false"
        x-on:change="$el.__x_model && $el.__x_model.set($el.checked)"
        class="rounded border-gray-700 text-blue-600 bg-gray-800 focus:ring-2 focus:ring-blue-500" x-model="$store.storyGeneration.test"
    >

            <span class="text-white">Test</span>
    </label>

            </div>
            <div class="flex gap-3">
                <div class="flex-1">
                    <label for="reference-story-id" class="block mb-1 text-sm font-medium">Reference ID</label>
                    <input
    x-bind:value="$el.__x_model ? $el.__x_model.get() : ''"
    x-on:input="$el.__x_model && $el.__x_model.set($el.value)"
    class="w-full p-2 border rounded bg-gray-800 border-gray-700 text-white" id="reference-story-id" x-model="$store.storyGeneration.reference_story_id" placeholder="Ref. ID"
>
                    <p x-show="$store.queues.referenceStoryId" class="text-xs mt-1 text-gray-400" x-text="`Queue: ${$store.queues.referenceStoryId}`"></p>
                </div>
                <div class="flex-1">
                    <label for="reference-type" class="block mb-1 text-sm font-medium">Reference Type</label>
                    <input
    x-bind:value="$el.__x_model ? $el.__x_model.get() : ''"
    x-on:input="$el.__x_model && $el.__x_model.set($el.value)"
    class="w-full p-2 border rounded bg-gray-800 border-gray-700 text-white" id="reference-type" x-model="$store.storyGeneration.reference_type" placeholder="Ref. Type"
>
                    <p x-show="$store.queues.referenceType" class="text-xs mt-1 text-gray-400" x-text="`Queue: ${$store.queues.referenceType}`"></p>
                </div>
            </div>
            <div class="flex gap-3">
                <div class="flex-1">
                    <select
    class="w-full p-2 border rounded bg-gray-800 border-gray-700 text-white" label="Geo Replace" x-data="{ options: $store.geoReplaces.list.map(r => ({ value: r.id, label: r.title })) }" x-model="$store.storyGeneration.geoReplace.id"
>
    <option value="">Choose geo</option>

    <template
        x-if="$el.__x_model && !options.some(i => (typeof i === 'object' ? i.value : i) === $el.__x_model.get())"
    >
        <option
            :value="$el.__x_model.get()"
            x-text="$el.__x_model.get()"
            selected
        ></option>
    </template>

    <template x-for="option in options" :key="typeof option === 'object' ? option.value : option">
        <option
            :value="typeof option === 'object' ? option.value : option"
            x-text="typeof option === 'object' ? option.label : option"
            :disabled="typeof option === 'object' && 'disabled' in option ? option.disabled : false"
        ></option>
    </template>
</select>
                </div>
                <div class="flex-1">
                    <select
    class="w-full p-2 border rounded bg-gray-800 border-gray-700 text-white" label="Voice Gender" x-data="{ options: [{ value: 'male', label: 'Male' }, { value: 'female', label: 'Female' }] }" x-model="$store.storyGeneration.geoReplace.voice_gender"
>
    <option value="">Select voice</option>

    <template
        x-if="$el.__x_model && !options.some(i => (typeof i === 'object' ? i.value : i) === $el.__x_model.get())"
    >
        <option
            :value="$el.__x_model.get()"
            x-text="$el.__x_model.get()"
            selected
        ></option>
    </template>

    <template x-for="option in options" :key="typeof option === 'object' ? option.value : option">
        <option
            :value="typeof option === 'object' ? option.value : option"
            x-text="typeof option === 'object' ? option.label : option"
            :disabled="typeof option === 'object' && 'disabled' in option ? option.disabled : false"
        ></option>
    </template>
</select>
                </div>
            </div>
            <div>
                <select
    class="w-full p-2 border rounded bg-gray-800 border-gray-700 text-white" x-data="{ options: $store.backgroundMusic.options }" x-model="$store.storyGeneration.backgroundMusicId"
>
    <option value="">Choose a background music</option>

    <template
        x-if="$el.__x_model && !options.some(i => (typeof i === 'object' ? i.value : i) === $el.__x_model.get())"
    >
        <option
            :value="$el.__x_model.get()"
            x-text="$el.__x_model.get()"
            selected
        ></option>
    </template>

    <template x-for="option in options" :key="typeof option === 'object' ? option.value : option">
        <option
            :value="typeof option === 'object' ? option.value : option"
            x-text="typeof option === 'object' ? option.label : option"
            :disabled="typeof option === 'object' && 'disabled' in option ? option.disabled : false"
        ></option>
    </template>
</select>
            </div>
        </div>
    </div>

    <div class="flex flex-col gap-3">
        <div class="bg-gray-800/50 p-3 rounded-lg">
            <h3 @click="automationPromptsVisible = !automationPromptsVisible" class="font-bold text-lg mb-2 border-b border-gray-700 pb-2 flex justify-between items-center cursor-pointer">
                <span>Automation Prompts</span>
                <span class="text-gray-400">
                    <i class="fa-solid fa-chevron-down transition-transform" :class="{ 'rotate-180': !automationPromptsVisible }"></i>
                </span>
            </h3>
            <div x-show="automationPromptsVisible" x-collapse>
                <div class="space-y-3 pt-2">
                    <div>
                        <label for="story-prompt" class="block mb-1 text-sm font-medium">Story Prompt</label>
                        <textarea
    x-bind:value="$el.__x_model ? $el.__x_model.get() : ''"
    x-on:input="$el.__x_model && $el.__x_model.set($el.value)"
    class="w-full p-2 border rounded bg-gray-800 border-gray-700 text-white h-20" id="story-prompt" x-model="$store.automation.storyPrompt" placeholder="Enter your story prompt here"
></textarea>
                        <button class="px-2 py-1 rounded text-white text-center border-transparent flex items-center justify-center gap-2 bg-green-500 hover:bg-green-400 mt-1 !text-xs" @click="$store.automation.saveStoryPrompt">
            <i class="fa-solid fa-save"></i>
        Save Story Prompt
</button>
                    </div>
                    <div>
                        <label for="topic-prompt" class="block mb-1 text-sm font-medium">Topic Prompt</label>
                        <textarea
    x-bind:value="$el.__x_model ? $el.__x_model.get() : ''"
    x-on:input="$el.__x_model && $el.__x_model.set($el.value)"
    class="w-full p-2 border rounded bg-gray-800 border-gray-700 text-white h-20" id="topic-prompt" x-model="$store.automation.topicPrompt" placeholder="Enter your topic prompt here"
></textarea>
                        <button class="px-2 py-1 rounded text-white text-center border-transparent flex items-center justify-center gap-2 bg-green-500 hover:bg-green-400 mt-1 !text-xs" @click="$store.automation.saveTopicPrompt">
            <i class="fa-solid fa-save"></i>
        Save Topic Prompt
</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="bg-gray-800/50 p-3 rounded-lg flex flex-col">
            <h3 @click="imagePromptsVisible = !imagePromptsVisible" class="font-bold text-lg mb-2 border-b border-gray-700 pb-2 flex justify-between items-center cursor-pointer">
                <span>Image Generation Prompts</span>
                <span class="text-gray-400">
                    <i class="fa-solid fa-chevron-down transition-transform" :class="{ 'rotate-180': !imagePromptsVisible }"></i>
                </span>
            </h3>
            <div x-show="imagePromptsVisible" x-collapse class="flex-grow">
                <div class="flex gap-3 pt-2 h-full">
                    <div class="w-1/3 flex flex-col">
                        <label for="images-stylistics-prompt" class="block mb-1 text-sm font-medium">Stylistics Prompt</label>
                        <textarea
    x-bind:value="$el.__x_model ? $el.__x_model.get() : ''"
    x-on:input="$el.__x_model && $el.__x_model.set($el.value)"
    class="w-full p-2 border rounded bg-gray-800 border-gray-700 text-white h-32 flex-grow" id="images-stylistics-prompt" x-model="$store.automation.imagesStylisticsPrompts[$store.automation.currentImageGenerationStage - 1]" placeholder="e.g., hyperrealistic, 4k..."
></textarea>
                        <button class="px-2 py-1 rounded text-white text-center border-transparent flex items-center justify-center gap-2 bg-green-500 hover:bg-green-400 mt-2 !text-xs" @click="$store.automation.saveImagesStylisticsPrompt">
            <i class="fa-solid fa-save"></i>
        Save Stylistics
</button>
                    </div>
                    <div class="w-2/3 flex flex-col">
                        <div class="flex justify-between items-center mb-1">
                            <label for="images-prompt" class="block text-sm font-medium">Main Image Prompt</label>
                            <div class="flex gap-2">
    <template x-for="index in $store.automation.numberOfImageStages">
        <button
            @click="$store.automation.currentImageGenerationStage = index"
            x-bind:class="{
                'px-3 py-1 bg-blue-600 hover:bg-blue-500 text-white rounded': true,
                'bg-blue-900 hover:bg-blue-900': $store.automation.currentImageGenerationStage === index
            }"
            x-text="index"
        ></button>
    </template>
</div>
                        </div>
                        <textarea
    x-bind:value="$el.__x_model ? $el.__x_model.get() : ''"
    x-on:input="$el.__x_model && $el.__x_model.set($el.value)"
    class="w-full p-2 border rounded bg-gray-800 border-gray-700 text-white h-32 flex-grow" id="images-prompt" x-model="$store.automation.imagesPrompts[$store.automation.currentImageGenerationStage - 1]" placeholder="Use ~~~ as a placeholder for the scene text."
></textarea>
                        <button class="px-2 py-1 rounded text-white text-center border-transparent flex items-center justify-center gap-2 bg-green-500 hover:bg-green-400 mt-2 !text-xs" @click="$store.automation.saveImagesPrompt">
            <i class="fa-solid fa-save"></i>
        Save Main Prompt
</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
        </div>

        <div
            data-section-id="scenesTable"
            x-show="$store.ui.sections.find(s => s.id === 'scenesTable').visible && $store.storyGeneration.scenes.length > 0"
            class="relative border rounded-lg group p-1"
            x-bind:class="$store.ui.isMoveModeEnabled ? 'border-gray-600 group' : 'border-transparent'"
        >
            <div class="drag-handle absolute top-2 right-2 p-2 bg-gray-700 rounded-full cursor-grab opacity-0 group-hover:opacity-100 transition-opacity z-50">
                <i class="fa-solid fa-grip-vertical text-white"></i>
            </div>
            <div class="overflow-x-auto">
                <table class="mb-4 w-full text-left border border-gray-700">
    <thead class="bg-gray-800">
    <tr>
        <th class="p-2 border border-gray-700 w-16">Scene</th>
        <th class="p-2 border border-gray-700 w-40 max-w-40">Actions</th>
        <th class="p-2 border border-gray-700 w-60">
            <div class="flex gap-2 items-center justify-between">
                Prompt
                <button @click="$store.storyGeneration.copyStoryToClipboard" class="w-max px-2 py-1 bg-blue-500 hover:bg-blue-400 text-white rounded">
                    Copy to clipboard
                </button>
            </div>
        </th>
        <th class="p-2 border border-gray-700 w-60">
            <div class="flex gap-2 items-center justify-between text-nowrap">
                Image prompt
                <div class="flex gap-2">
    <template x-for="index in $store.automation.numberOfImageStages">
        <button
            @click="$store.automation.currentImageGenerationStage = index"
            x-bind:class="{
                'px-3 py-1 bg-blue-600 hover:bg-blue-500 text-white rounded': true,
                'bg-blue-900 hover:bg-blue-900': $store.automation.currentImageGenerationStage === index
            }"
            x-text="index"
        ></button>
    </template>
</div>
            </div>
        </th>
        <th class="p-2 border border-gray-700 w-60">Images</th>
        <th class="p-2 border border-gray-700 w-40 max-w-40">Voiceover</th>
        
    </tr>
    </thead>
    <tbody>
        <template x-for="(scene, index) in $store.storyGeneration.scenes" :key="index">
            <tr class="bg-gray-800">
                <td class="p-2 border border-gray-700 text-2xl font-bold">
                    №<span x-text="index + 1"></span>
                </td>
                <td class="p-2 border border-gray-700 grid gap-4">
                    <button class="px-2 py-1 rounded text-white text-center border-transparent flex items-center justify-center gap-2 bg-blue-700 hover:bg-blue-600" @click="$store.storyGeneration.generateSceneImagesPrompts(index)">
        Regenerate image prompt
</button>
                    <button class="px-2 py-1 rounded text-white text-center border-transparent flex items-center justify-center gap-2 bg-blue-700 hover:bg-blue-600" @click="$store.storyGeneration.generateSceneImages(index)">
        Regenerate image
</button>
                    <button class="px-2 py-1 rounded text-white text-center border-transparent flex items-center justify-center gap-2 bg-red-500 hover:bg-red-400" @dblclick="$store.storyGeneration.removeScene(index)">
        Remove scene
</button>
                    <button class="px-2 py-1 rounded text-white text-center border-transparent flex items-center justify-center gap-2 bg-green-500 hover:bg-green-400" @click="$store.storyGeneration.addSceneAfterWards(index)">
        Add scene
</button>
                    <label class="inline-flex items-center space-x-2">
    <input
        type="checkbox"
        x-bind:checked="$el.__x_model ? $el.__x_model.get() : false"
        x-on:change="$el.__x_model && $el.__x_model.set($el.checked)"
        class="rounded border-gray-700 text-blue-600 bg-gray-800 focus:ring-2 focus:ring-blue-500" x-model="scene.blocked"
    >

            <span class="text-white">Block</span>
    </label>

                </td>
                <td class="p-2 border border-gray-700">
                    <textarea
    x-bind:value="$el.__x_model ? $el.__x_model.get() : ''"
    x-on:input="$el.__x_model && $el.__x_model.set($el.value)"
    class="w-full p-2 border rounded bg-gray-800 border-gray-700 text-white" x-model="scene.prompt"
></textarea>
                </td>
                <td class="p-2 border border-gray-700">
                    <textarea
                        x-model="scene.imagePrompts[$store.automation.currentImageGenerationStage - 1]"
                        class="w-full h-32 p-2 border rounded bg-gray-700 border-gray-600 text-white"
                    ></textarea>
                </td>
                <td class="p-2 border border-gray-700">
                    <span x-show="scene.images.length > 0" class="grid grid-cols-2 gap-4">
                        <template x-for="(image, imgIndex) in scene.images" :key="imgIndex">
                            <a :href="image" target="_blank" class="block text-blue-400 hover:underline block">
                                <img
                                    x-bind:src="image"
                                    x-bind:alt="'Image ' + (imgIndex + 1)"
                                    width="288"
                                    height="512"
                                >
                            </a>
                        </template>
                    </span>
                </td>
                <td class="p-2 border border-gray-700">
                    <template
                        x-for="(audioScene, audioSceneIndex) in $store.audioScenes.filterBySceneNumber(index + 1)"
                        :key="audioSceneIndex"
                    >
                        <span x-show="audioScene.audio_url" class="block">
                            <audio :src="audioScene.audio_url" controls class="w-full"></audio>
                        </span>
                    </template>
                </td>
            </tr>
        </template>
    </tbody>
</table>
            </div>
        </div>

        <div
            data-section-id="storiesManagement"
            x-show="$store.ui.sections.find(s => s.id === 'storiesManagement').visible"
            class="relative border rounded-lg group p-1"
            x-bind:class="$store.ui.isMoveModeEnabled ? 'border-gray-600 group' : 'border-transparent'"
        >
            <div class="drag-handle absolute top-2 right-2 p-2 bg-gray-700 rounded-full cursor-grab opacity-0 group-hover:opacity-100 transition-opacity z-50">
                <i class="fa-solid fa-grip-vertical text-white"></i>
            </div>
            <div class="my-6">
    <div class="flex justify-between items-center mb-4 p-2 bg-gray-800/50 rounded-lg">
        <h2 class="text-lg font-bold mr-4">Story History</h2>

        <div class="flex items-center gap-4 flex-grow">
            <div class="flex items-center gap-2">
                <span class="text-sm font-medium text-gray-300">Preview:</span>
                <div class="flex gap-1 bg-gray-800 p-1 rounded-md">
                    <button @click="$store.stories.filterPreviewImage = 'all'" :class="{'bg-blue-600': $store.stories.filterPreviewImage === 'all'}" class="px-2 py-0.5 text-xs rounded">All</button>
                    <button @click="$store.stories.filterPreviewImage = 'yes'" :class="{'bg-blue-600': $store.stories.filterPreviewImage === 'yes'}" class="px-2 py-0.5 text-xs rounded">Yes</button>
                    <button @click="$store.stories.filterPreviewImage = 'no'" :class="{'bg-blue-600': $store.stories.filterPreviewImage === 'no'}" class="px-2 py-0.5 text-xs rounded">No</button>
                </div>
            </div>
            <div class="flex items-center gap-2">
                <span class="text-sm font-medium text-gray-300">Middle Video:</span>
                <div class="flex gap-1 bg-gray-800 p-1 rounded-md">
                    <button @click="$store.stories.filterMiddleVideo = 'all'" :class="{'bg-blue-600': $store.stories.filterMiddleVideo === 'all'}" class="px-2 py-0.5 text-xs rounded">All</button>
                    <button @click="$store.stories.filterMiddleVideo = 'yes'" :class="{'bg-blue-600': $store.stories.filterMiddleVideo === 'yes'}" class="px-2 py-0.5 text-xs rounded">Yes</button>
                    <button @click="$store.stories.filterMiddleVideo = 'no'" :class="{'bg-blue-600': $store.stories.filterMiddleVideo === 'no'}" class="px-2 py-0.5 text-xs rounded">No</button>
                </div>
            </div>
            <div class="flex items-center gap-2">
                <label for="ref-id-filter" class="text-sm font-medium text-gray-300 whitespace-nowrap">Ref. ID:</label>
                <input
    x-bind:value="$el.__x_model ? $el.__x_model.get() : ''"
    x-on:input="$el.__x_model && $el.__x_model.set($el.value)"
    class="w-full p-2 border rounded bg-gray-800 border-gray-700 text-white !py-1 !text-sm w-20" id="ref-id-filter" x-model.debounce.300ms="$store.stories.filterReferenceId" placeholder="Enter..."
>
            </div>
            <div class="flex items-center gap-2">
                <label for="ref-type-filter" class="text-sm font-medium text-gray-300 whitespace-nowrap">Ref. Type:</label>
                <input
    x-bind:value="$el.__x_model ? $el.__x_model.get() : ''"
    x-on:input="$el.__x_model && $el.__x_model.set($el.value)"
    class="w-full p-2 border rounded bg-gray-800 border-gray-700 text-white !py-1 !text-sm w-28" id="ref-type-filter" x-model.debounce.300ms="$store.stories.filterReferenceType" placeholder="Enter..."
>
            </div>
        </div>

        <div class="flex items-center gap-2">
            <div class="flex gap-1 bg-gray-800 p-1 rounded-lg">
                <template x-for="filter in $store.stories.filters">
                    <button
                        @click="$store.stories.currentFilter = filter"
                        class="px-3 py-1 text-xs font-semibold rounded-md transition-colors"
                        :class="{
                            'bg-blue-600 text-white': filter === $store.stories.currentFilter,
                            'text-gray-300 hover:bg-gray-700': filter !== $store.stories.currentFilter,
                        }"
                        x-text="filter"
                    ></button>
                </template>
            </div>
            <button @click="$store.stories.fetchAll()" class="p-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg" title="Refresh History">
                <i class="fa-solid fa-arrows-rotate"></i>
            </button>
        </div>
    </div>

    <div x-show="$store.stories.list.length" class="overflow-x-auto mt-4">
        <table class="w-full text-left border-collapse border border-gray-700">
            <thead class="bg-gray-800">
            <tr>
                <th class="p-2 border border-gray-700 w-10"></th>
                <th class="p-2 border border-gray-700">ID</th>
                <th class="p-2 border border-gray-700">Date</th>
                <th class="p-2 border border-gray-700">Topic</th>
                <th class="p-2 border border-gray-700">Preview</th>
                <th class="p-2 border border-gray-700">Duration</th>
                <th class="p-2 border border-gray-700">Finished</th>
                <th class="p-2 border border-gray-700">Geo Replace</th>
                <th class="p-2 border border-gray-700">Test</th>
                <th class="p-2 border border-gray-700">Reference ID</th>
                <th class="p-2 border border-gray-700">Reference Type</th>
                <th class="p-2 border border-gray-700">Archive ID</th>
                <th class="p-2 border border-gray-700">Actions</th>
            </tr>
            </thead>
            <tbody>
            <template x-for="story in $store.stories.filtered" :key="story.id + '-' + story.isOriginal">
                <tr
                    class="align-middle"
                    x-show="!story.isOriginal ? $store.stories.isExpanded(story.reference_story_id) : true"
                    x-bind:class="{
                            'bg-yellow-700': story.replacement,
                            'bg-gray-400': story.duplicate,
                            'bg-gray-800': story.finished,
                            'bg-yellow-900/50': !story.isOriginal,
                        }"
                >
                    <td class="p-2 border-b border-gray-700 text-center">
                        <button
                            x-show="story.isOriginal && story.replacesCount > 0"
                            @click="$store.stories.toggleExpand(story.id)"
                            class="flex flex-col items-center"
                        >
                            <i class="fa-solid fa-chevron-down transition-transform" :class="{ 'rotate-180': $store.stories.isExpanded(story.id) }"></i>
                            <div class="flex gap-1 text-xs mt-1">
                                <span class="text-green-400" x-text="story.replacesCount"></span>
                                <span class="text-purple-400" x-text="story.replacesWithMiddleVideoCount"></span>
                                <span class="text-yellow-400" x-text="story.replacesWithPreviewImageCount"></span>
                        </button>
                    </td>
                    <td class="p-2 border-b border-gray-700 font-bold" :class="{'pl-8': !story.isOriginal}" x-text="story.id"></td>
                    <td class="p-2 border-b border-gray-700" x-text="story.date"></td>
                    <td class="p-2 border-b border-gray-700 text-xs max-w-xs truncate" x-text="story.topic"></td>
                    <td class="p-2 border-b border-gray-700 text-center">
                        <span x-text="story.preview_image_path ? 'Yes' : 'No'"></span>
                    </td>
                    <td class="p-2 border-b border-gray-700 text-center" x-text="story.formattedDuration"></td>
                    <td class="p-2 border-b border-gray-700 text-center">
                        <span x-text="story.finished ? 'Yes' : 'No'"></span>
                    </td>
                    <td class="p-2 border-b border-gray-700 text-center">
                        <span x-text="story.replacement ? 'Yes' : 'No'"></span>
                    </td>
                    <td class="p-2 border-b border-gray-700 text-center">
                        <span x-text="story.test ? 'Yes' : 'No'"></span>
                    </td>
                    <td class="p-2 border-b border-gray-700 font-bold text-center" x-text="story.reference_story_id"></td>
                    <td class="p-2 border-b border-gray-700 font-bold" x-text="story.reference_type"></td>
                    <td class="p-2 border-b border-gray-700 font-bold text-center" x-text="story.story_archive_id"></td>
                    <td class="p-2 border-b border-gray-700">
                        <div class="flex gap-2 justify-center">
                            <button @click="$store.stories.apply(story)" class="px-4 py-2 bg-gray-500 hover:bg-gray-400 text-white rounded">Apply</button>
                            <button @dblclick="$store.stories.delete(story)" class="px-4 py-2 bg-red-500 hover:bg-red-400 text-white rounded" title="Double-click to delete">Delete</button>
                        </div>
                    </td>
                </tr>
            </template>
            </tbody>
        </table>
    </div>
</div>
        </div>

        <div
            data-section-id="geoQueueEditor"
            x-show="$store.ui.sections.find(s => s.id === 'geoQueueEditor').visible"
            class="relative border rounded-lg group p-1"
            x-bind:class="$store.ui.isMoveModeEnabled ? 'border-gray-600 group' : 'border-transparent'"
        >
            <div class="drag-handle absolute top-2 right-2 p-2 bg-gray-700 rounded-full cursor-grab opacity-0 group-hover:opacity-100 transition-opacity z-50">
                <i class="fa-solid fa-grip-vertical text-white"></i>
            </div>
            <div class="my-6" x-data x-init="$store.geoQueue.reset()">
    <h2 class="text-lg font-bold mb-4">Geo Voice Queue Editor</h2>

    <!-- Queue title -->
    <div class="mb-4">
        <input
    x-bind:value="$el.__x_model ? $el.__x_model.get() : ''"
    x-on:input="$el.__x_model && $el.__x_model.set($el.value)"
    class="w-full p-2 border rounded bg-gray-800 border-gray-700 text-white" label="Queue title" x-model="$store.geoQueue.queue.title"
>
    </div>

    <!-- Add item form -->
    <div class="flex gap-4 mb-4 items-end">
        <div class="w-1/3">
            <select
    class="w-full p-2 border rounded bg-gray-800 border-gray-700 text-white" label="Geo Replace" x-data="{ options: $store.geoReplaces.list.map(r => ({ value: r.id, label: r.title })) }" x-model="$store.geoQueue.newItem.geo_replace_id"
>
    <option value="">Choose geo</option>

    <template
        x-if="$el.__x_model && !options.some(i => (typeof i === 'object' ? i.value : i) === $el.__x_model.get())"
    >
        <option
            :value="$el.__x_model.get()"
            x-text="$el.__x_model.get()"
            selected
        ></option>
    </template>

    <template x-for="option in options" :key="typeof option === 'object' ? option.value : option">
        <option
            :value="typeof option === 'object' ? option.value : option"
            x-text="typeof option === 'object' ? option.label : option"
            :disabled="typeof option === 'object' && 'disabled' in option ? option.disabled : false"
        ></option>
    </template>
</select>
        </div>

        <div class="w-1/4">
            <select
    class="w-full p-2 border rounded bg-gray-800 border-gray-700 text-white" label="Voice Gender" x-data="{ options: [{ value: 'male', label: 'Male' }, { value: 'female', label: 'Female' }] }" x-model="$store.geoQueue.newItem.voice_gender"
>
    <option value="">Select gender</option>

    <template
        x-if="$el.__x_model && !options.some(i => (typeof i === 'object' ? i.value : i) === $el.__x_model.get())"
    >
        <option
            :value="$el.__x_model.get()"
            x-text="$el.__x_model.get()"
            selected
        ></option>
    </template>

    <template x-for="option in options" :key="typeof option === 'object' ? option.value : option">
        <option
            :value="typeof option === 'object' ? option.value : option"
            x-text="typeof option === 'object' ? option.label : option"
            :disabled="typeof option === 'object' && 'disabled' in option ? option.disabled : false"
        ></option>
    </template>
</select>
        </div>

        <button class="px-2 py-1 rounded text-white text-center border-transparent flex items-center justify-center gap-2 bg-green-500 hover:bg-green-400" @click="$store.geoQueue.addItem">
            <i class="fa-solid fa-plus"></i>
        Add Item
</button>
    </div>

    <!-- Current queue items table -->
    <div x-show="$store.geoQueue.queue.items.length" class="overflow-x-auto mt-2">
        <table class="w-full text-left border border-gray-700">
            <thead class="bg-gray-800">
            <tr>
                <th class="p-2 border border-gray-700">#</th>
                <th class="p-2 border border-gray-700">Geo</th>
                <th class="p-2 border border-gray-700">Gender</th>
                <th class="p-2 border border-gray-700">Voice</th>
                <th class="p-2 border border-gray-700 w-10"></th>
            </tr>
            </thead>
            <tbody>
            <template x-for="(item, index) in $store.geoQueue.queue.items" :key="index">
                <tr class="bg-gray-800">
                    <td class="p-2 border border-gray-700" x-text="index + 1"></td>
                    <td class="p-2 border border-gray-700"
                        x-text="$store.geoReplaces.list.find(r => r.id == item.geo_replace_id)?.title || 'Unknown'">
                    </td>
                    <td class="p-2 border border-gray-700 capitalize" x-text="item.voice_gender"></td>
                    <td class="p-2 border border-gray-700">
                            <span x-text="(() => {
                                const geo = $store.geoReplaces.find(item.geo_replace_id);
                                if (!geo) return '-';
                                return item.voice_gender === 'male'
                                    ? ($store.voices.customizedList.find(v => v.id == geo.male_customized_voice_id)?.title || '-')
                                    : ($store.voices.customizedList.find(v => v.id == geo.female_customized_voice_id)?.title || '-');
                            })()"></span>
                    </td>
                    <td class="p-2 border border-gray-700">
                        <button class="px-2 py-1 rounded text-white text-center border-transparent flex items-center justify-center gap-2 bg-red-500 hover:bg-red-400" @click="$store.geoQueue.removeItem(index)">
            <i class="fa-solid fa-trash"></i>
        
</button>
                    </td>
                </tr>
            </template>
            </tbody>
        </table>
    </div>

    <!-- Save -->
    <div class="flex gap-4 mt-6">
        <button class="px-2 py-1 rounded text-white text-center border-transparent flex items-center justify-center gap-2 bg-blue-700 hover:bg-blue-600" @click="$store.geoQueue.save">
            <i class="fa-solid fa-save"></i>
        Save
</button>

        <button class="px-2 py-1 rounded text-white text-center border-transparent flex items-center justify-center gap-2 bg-gray-700 hover:bg-gray-600" @click="$store.geoQueue.saveAsNew">
            <i class="fa-solid fa-copy"></i>
        Save as New
</button>
    </div>

    <!-- Saved Templates -->
    <template x-if="$store.geoQueue.list.length">
        <div class="mt-10">
            <h3 class="text-md font-semibold mb-2">Saved Queues</h3>
            <div class="space-y-2">
                <template x-for="(queue, index) in $store.geoQueue.list" :key="index">
                    <div class="p-3 bg-gray-500 rounded flex items-center justify-between">
                        <div>
                            <strong x-text="queue.title"></strong>
                            <span class="text-sm text-gray-300 ml-2" x-text="'(' + queue.items.length + ' items)'"></span>
                        </div>
                        <div class="flex gap-2">
                            <button class="px-2 py-1 rounded text-white text-center border-transparent flex items-center justify-center gap-2 bg-blue-700 hover:bg-blue-600" @click="$store.geoQueue.loadForEdit(queue)">
            <i class="fa-solid fa-pen-to-square"></i>
        Edit
</button>

                            <button class="px-2 py-1 rounded text-white text-center border-transparent flex items-center justify-center gap-2 bg-gray-700 hover:bg-gray-600" @click="$store.geoQueue.loadAsNew(queue)">
            <i class="fa-solid fa-copy"></i>
        Copy
</button>

                            <button class="px-2 py-1 rounded text-white text-center border-transparent flex items-center justify-center gap-2 bg-red-500 hover:bg-red-400" @click="$store.geoQueue.deleteQueue(index)">
            <i class="fa-solid fa-trash"></i>
        
</button>
                        </div>
                    </div>
                </template>
            </div>
        </div>
    </template>
</div>
        </div>

        <div
            data-section-id="previewImageEditor"
            x-show="$store.ui.sections.find(s => s.id === 'previewImageEditor').visible"
            class="relative border rounded-lg group p-1"
            x-bind:class="$store.ui.isMoveModeEnabled ? 'border-gray-600 group' : 'border-transparent'"
        >
            <div class="drag-handle absolute top-2 right-2 p-2 bg-gray-700 rounded-full cursor-grab opacity-0 group-hover:opacity-100 transition-opacity z-50">
                <i class="fa-solid fa-grip-vertical text-white"></i>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 max-w-4xl py-2" x-data="{ inputValue: '' }">
    
    <div
        class="space-y-4"
        x-init="$store.previewImage.inputRef = $refs.previewImageInput"
    >
        <div class="space-y-1">
            <label for="previewImageInput" class="block text-sm font-medium text-white">Select a preview image</label>
            <input
                type="file"
                x-ref="previewImageInput"
                accept="image/*"
                class="block w-full text-sm text-white bg-transparent file:mr-4 file:py-2 file:px-4
                       file:rounded-md file:border-0
                       file:text-sm file:font-medium
                       file:bg-teal-600 file:text-white
                       hover:file:bg-teal-700 transition-colors duration-200"
            >
        </div>

        <div x-show="$store.storyGeneration.previewImagePath" class="mt-4">
            <label class="block text-sm font-medium text-white">Image Preview</label>
            <img
                x-bind:src="($store.storyGeneration.previewImagePath || '').replace('storage/app/public/', '/storage/')"
                alt="Preview Image"
                class="mt-2 w-full object-cover rounded-md shadow-lg"
            >
        </div>

        <div class="flex flex-wrap gap-2">
            <button class="px-2 py-1 rounded text-white text-center border-transparent flex items-center justify-center gap-2 bg-blue-700 hover:bg-blue-600" @click="$store.previewImage.uploadImage" x-bind:disabled="$store.previewImage.isUploading">
            <i class="fa-solid fa-upload"></i>
        <span x-text="$store.previewImage.isUploading ? 'Uploading...' : 'Upload Image'"></span>
</button>
        </div>
    </div>

    
    
</div>
        </div>
    </div>
        </div>
    </body>
</html>
